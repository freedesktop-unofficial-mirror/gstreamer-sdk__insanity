{% extends "insanity/base.html" %}
{% load insanity_extra %}

{% block title %}
Matrix View of Testrun #{{testrun.id}}
{% endblock %}

{% block content %}

    <!-- We're supposing we only have one test type and we ignore scenarios -->
    <table width="98%">
      <tr>
	<th class="side">Test type</th>
	<th>Results for Testrun #{{testrun.id}}</th>
      </tr>
      {% for sortedtest in sortedtests %}
      <tr>
	<th class="side">{{ sortedtest.type.type }}</th>
	<td>
	  <table>
	    <tr>
	      <th>ID</th>
	      {% for arg in sortedtest.type.arguments.all %}
	        <th>{% split_dash_lines arg.name %}</th>
	      {% endfor %}
	      <th>Result</th>
	      {% for item in sortedtest.fullchecklist %}
	        <th><span title="{{item.name}}">{% verticalize item.name %}</span></th>
	      {% endfor %}
	      <th>Errors seen</th>
	    </tr>
	    
	    {% for test in sortedtest.tests %}
	      {% matrix_checklist_row test sortedtest.fullchecklist sortedtest.fullarguments %}
	    {% endfor %}
	
	  </table>
	</td>
      </tr>
      {% endfor %}
    </table>

<div id="debug">
  <h2>Queries</h2>
  <p>
    {{ sql_queries|length }} Quer{{ sql_queries|pluralize:"y,ies" }}
    {% ifnotequal sql_queries|length 0 %}
    (<span style="cursor: pointer;" onclick="var s=document.getElementById('debugQueryTable').style;s.display=s.display=='none'?'':'none';this.innerHTML=this.innerHTML=='Show'?'Hide':'Show';">Show</span>)
    {% endifnotequal %}
  </p>
  <table id="debugQueryTable" style="display: none;">
    <col width="1"></col>
    <col></col>
    <col width="1"></col>
    <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">SQL</th>
      <th scope="col">Time</th>
    </tr>
    </thead>
    <tbody>
    {% for query in sql_queries %}<tr class="{% cycle odd,even %}">
      <td>{{ forloop.counter }}</td>
      <td>{{ query.sql|escape }}</td>
      <td>{{ query.time }}</td>
    </tr>{% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
